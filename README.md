
# Environment Model

Цель этого репозитория заключается в том, чтобы создать слой
моделей, который не будет зависить от окружения в которм испольняется.
А точнее будет существовать возможность настроить специальное
поведение для конкретного окружения внутри самой модели.

## Установка
Установить пакет можно через композер:
```bash
$ composer require kosuha606/environment-models
```

## Быстрый старт

Самый простой пример приведен в тестах этого репозитория.
В тестах используется провайдер данных, который берет данные
из массива в своем свойстве. 

Класс kosuha606\EnvironmentModel\Example\MemoryModelProvider;

По подобию этого класса вы можете реализовать провайдер для необходимого
вам типа хранения данных, например, для Doctrine, ActiveRecord, Eloquent.

Далее провайдер передается в менеджер моделей.

```php
$provider = new MemoryModelProvider();
EnvironmentModelManager::getInstance()->setProvider($provider);
```

Эта настройка может быть сделана средствами DI фреймворка или непосредственно как в моем случае.

Далее необходимо описать простейщую модель:
```php
class Product extends EnvironmentModel
{
    public function attributes(): array
    {
        return [
            'name',
            'price',
            'color',
            'size',
            'amount',
        ];
    }
}
```

После этого можно уже запрашивать данные о модели из EnvironmentModelManager таким образом:
```php
$products = EnvironmentModelManager::getInstance()->getProvider()->many(Product::class, [
    'where' => [
        ['all']
    ]
]);
```

В публичном интерфейсе EnvironmentModelManager доступно два метода: many, one. Первый - запрашивает у провайдера
данные для многих записей и по полученным данным строит объекты моделей, передавая environment провайдера. 
Второй - представляет из себя массив конфигруации запроса, формат массива зависит от провайдера, с которым на данный
момент связан EnvironmentModelManager.

После проделанных операций на выходе мы должны получить массив $products если конечно в провайдере были необходимые данные
для построения моделей.

## Провайдер данных модели

Как уже было сказано выше провайдеры можно создавать какие угодно. Провайдеры могут давать доступ к данным либо через 
ORM механизмы, либо через запросы к апи каких-то сервисов, всех вариантов не перечесть.

Сделать свой провайдер можно следующим образом. Необходимо создать новый класс, унаследовать класс EnvironmentModelProvider
и реализовать 3 абстрактныйх метода: environemnt, findOne, findMany. environemnt - просто должен вернуть строку текущего 
окружения провайдера, findOne и findMany думаю не требуют пояснений, просто первый возвращает массив с атрибутами одной 
модели, второй возвращает массив с многими атрибутами нескольких моделей.

environment необходим для того чтобы модели могли переопределять свои getters и setters под специфические окружения
